using System;
using System.Collections;
using System.Collections.Generic;
using Unity.Mathematics;
using Unity.VisualScripting;
using UnityEngine;
using UnityEngine.SceneManagement;

public class MalwarePickerHolder : MonoBehaviour, IInteractable
{

    public MalwarePackage malwarePackage;

    public MalwareLibrary malwareLibrary;

    private SpriteRenderer _spriteRenderer;
    // Start is called before the first frame update
    void Start()
    {
    }

    public void SetUpMalwarePackage()
    {
        _spriteRenderer = GetComponentInChildren<SpriteRenderer>();

        gameObject.transform.GetChild(0).transform.localScale = new Vector3(malwarePackage.mines.Count+2, 1.5f, 1);

        for (int i = 0; i < malwarePackage.mines.Count; i++)
        {
            GameObject gameObjectCurrent = new GameObject("MineVisual Holder")
            {
                transform =
                {
                    parent = gameObject.transform,
                    localPosition = Vector3.right * (i - (float)malwarePackage.mines.Count/2) + new Vector3(0.5f, 0,0),
                    rotation = quaternion.identity,
                }
            };
            SpriteRenderer spriteRendererCurrent = gameObjectCurrent.AddComponent<SpriteRenderer>();
            spriteRendererCurrent.sprite = malwarePackage.mines[i].sprite;
            spriteRendererCurrent.sortingOrder = 13;
            BoxCollider2D boxCollider2D = gameObjectCurrent.AddComponent<BoxCollider2D>();
            boxCollider2D.size = new Vector2(1, 1);
            MineVisualHover mineVisualHover = gameObjectCurrent.AddComponent<MineVisualHover>();
            mineVisualHover._mine = malwarePackage.mines[i];
        }
    }

    // Update is called once per frame
    void Update()
    {
        
    }

    public void Interact()
    {
        RunPlayerStats.Instance.AddMalwarePackage(malwarePackage);
        //RunPlayerStats.Instance.MalwarePackages.ForEach(x => x.mines.ForEach(y => Debug.Log(y.name)));

        SoundManager.Instance.Play("Click", transform, true, 1);
        
        //TODO: Fix that this is not here
        //SceneDeterminer.Instance.RoomStartVisual.OpenDoor();
        SceneDeterminer.ReturnToFloorAfter("MalwarePicker");
    }

    public void SecondInteract()
    {
        
    }
}
